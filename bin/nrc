#!/usr/bin/env bash

set -euo pipefail

statix check
nix fmt ./flake.nix ./hosts ./modules ./templates --quiet
git add --intent-to-add . 
set +e
sudo nixos-rebuild build $@ --option substitute false
nvd diff /run/current-system result